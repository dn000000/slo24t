# Система Автоматического Бэкапа

Система предназначена для автоматизированного создания резервных копий указанных директорий с поддержкой различных методов резервного копирования и гибкого расписания.

## Возможности

- Поддержка трёх методов резервного копирования:
  - Полное резервное копирование (full)
  - Инкрементальное резервное копирование (incremental)
  - Дифференциальное резервное копирование (differential)
- Гибкое расписание выполнения бэкапов:
  - Ежедневно
  - Еженедельно
  - Ежемесячно
  - По "customized" интервалу в секундах
- Восстановление данных из любой существующей резервной копии
- Подробное логирование всех операций
- Возможность немедленного запуска резервного копирования
- Интерактивное восстановление данных

## Зависимости

Для работы системы требуется:

- Python 3.x
- APScheduler (`pip install apscheduler`)

## Установка

1. Склонируйте репозиторий или скопируйте файлы `backup_script.py` и `test_backup.sh`
2. Установите необходимые зависимости:
```bash
pip install apscheduler
```

## Настройка

Настройка системы осуществляется через словарь `config` в файле `backup_script.py`:

```python
config = {
    'backup_directories': ['/path/to/directory1', '/path/to/directory2'],  # Директории для резервного копирования
    'backup_destination': '/path/to/backup_destination',  # Место хранения резервных копий
    'backup_method': 'incremental',  # Метод резервного копирования
    'schedule': {
        'interval': 'daily',  # Интервал выполнения
        'time': '02:00',     # Время выполнения
    },
    'log_file': 'backup.log',  # Путь к файлу логов
}
```

### Параметры конфигурации:

- `backup_directories`: список путей к директориям, которые нужно резервировать
- `backup_destination`: путь к директории, где будут храниться резервные копии
- `backup_method`: метод резервного копирования
  - `'full'`: полная копия всех файлов
  - `'incremental'`: копирование только изменённых файлов с момента последнего бэкапа
  - `'differential'`: копирование файлов, изменённых с момента последнего полного бэкапа
- `schedule`:
  - `interval`: `'daily'`, `'weekly'`, `'monthly'` или число секунд
  - `time`: время запуска в формате `'HH:MM'`
- `log_file`: путь к файлу журнала

## Использование

### Запуск в режиме планировщика:

```bash
python backup_script.py
```

### Немедленное выполнение резервного копирования:

```bash
python backup_script.py --backup-now
```

### Восстановление данных:

```bash
python backup_script.py --restore
```

## Принцип работы

### Методы резервного копирования

1. **Полное резервное копирование (full)**:
   - Создаёт полную копию всех файлов из указанных директорий
   - Занимает больше всего места
   - Самый надёжный метод
   
2. **Инкрементальное резервное копирование (incremental)**:
   - Сохраняет только файлы, изменённые с момента последнего бэкапа (любого типа)
   - Экономит место на диске
   - Требует всю цепочку бэкапов для восстановления
   
3. **Дифференциальное резервное копирование (differential)**:
   - Сохраняет файлы, изменённые с момента последнего полного бэкапа
   - Промежуточный вариант по объёму
   - Требует последний полный бэкап и последний дифференциальный для восстановления

### Процесс резервного копирования

1. Создаётся новая директория с именем в формате: `backup_YYYYMMDDHHMMSS_method`
2. В зависимости от выбранного метода:
   - Копируются все файлы (full)
   - Сравниваются файлы с последним бэкапом (incremental)
   - Сравниваются файлы с последним полным бэкапом (differential)
3. Все операции логируются в файл журнала

### Процесс восстановления

1. Показывается список доступных резервных копий
2. Пользователь выбирает нужную копию
3. После подтверждения:
   - Удаляются текущие данные в целевых директориях
   - Восстанавливаются данные из выбранной резервной копии
4. Процесс восстановления логируется

## Тестирование

В комплекте идёт скрипт `test_backup.sh` для проверки работоспособности системы. Он:

- Создаёт тестовое окружение
- Проверяет первичное резервное копирование
- Тестирует инкрементальное резервное копирование
- Проверяет процесс восстановления
- Верифицирует работу системы логирования

Для запуска тестов:

```bash
chmod +x test_backup.sh
./test_backup.sh
```

## Логирование

Все операции системы логируются в указанный в конфигурации файл. Записываются:
- Время операции
- Тип операции
- Результат выполнения
- Ошибки и предупреждения

## Безопасность

- Перед восстановлением требуется подтверждение
- Все операции логируются
- Исходные данные не изменяются при создании резервных копий
