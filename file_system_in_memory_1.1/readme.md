# MemFS - Виртуальная файловая система в памяти

MemFS представляет собой простую реализацию виртуальной файловой системы в памяти, с использованием FUSE (Filesystem in Userspace). Система поддерживает базовые операции с файлами и директориями, обеспечивая временное хранение данных, которые удаляются после размонтирования файловой системы.

## Возможности

- Создание и удаление файлов и директорий
- Чтение и запись файлов
- Поддержка вложенных директорий
- Базовые атрибуты файлов (права доступа, временные метки)
- Потокобезопасное выполнение операций

## Зависимости

Для сборки и работы MemFS требуются следующие компоненты:

- GCC (GNU Compiler Collection)
- libfuse3-dev (FUSE 3.x)
- make
- pkg-config

На Ubuntu/Debian установка зависимостей:

```bash
sudo apt-get update
sudo apt-get install gcc libfuse3-dev make pkg-config
```

## Сборка

```bash
gcc -o memfs memfs.c `pkg-config fuse3 --cflags --libs` -pthread
```

## Использование

```bash
# Создание точки монтирования
mkdir /tmp/memfs

# Запуск файловой системы
./memfs /tmp/memfs

# Для запуска в режиме отладки (foreground)
./memfs -f /tmp/memfs

# Размонтирование
fusermount -u /tmp/memfs
```

## Архитектура

### Структура данных

Основной структурой данных является дерево узлов `vfs_node_t`, где каждый узел представляет собой файл или директорию:

```c
typedef struct vfs_node {
    char *name;                  // Имя файла/директории
    mode_t mode;                 // Режим доступа и тип узла
    uid_t uid;                  // ID пользователя
    gid_t gid;                  // ID группы
    size_t size;                // Размер файла
    time_t atime, mtime, ctime; // Временные метки доступа
    struct vfs_node *parent;    // Родительский узел
    struct vfs_node **children; // Массив дочерних узлов
    size_t children_count;      // Количество дочерних узлов
    size_t children_capacity;   // Ёмкость массива children
    char *data;                 // Содержимое файла
} vfs_node_t;
```

### Ключевые компоненты

1. **Управление памятью**
   - Динамическое выделение памяти для узлов и данных файлов
   - Автоматическое освобождение памяти при удалении файлов/директорий

2. **Синхронизация**
   - Использование pthread_mutex для потокобезопасности
   - Защита общих структур данных при параллельном доступе

3. **Файловые операции**
   - Реализация базового набора операций FUSE
   - Поддержка создания, чтения, записи и удаления файлов
   - Управление директориями и их содержимым

### Обработка ошибок

- Проверка на NULL при выделении памяти
- Обработка ошибок файловой системы (ENOENT, EEXIST, и т.д.)
- Возврат соответствующих кодов ошибок POSIX

## Тестирование

В комплекте с файловой системой поставляется скрипт тестирования `test_memfs_debug.sh`, который проверяет основную функциональность:

### Возможности скрипта тестирования

1. **Подготовка окружения**
   - Автоматическое создание точки монтирования
   - Очистка предыдущих тестовых данных
   - Монтирование файловой системы

2. **Набор тестов**
   - Создание директорий
   - Создание и запись файлов
   - Чтение файлов и проверка содержимого
   - Проверка списка файлов
   - Создание вложенных структур
   - Удаление файлов и директорий
   - Проверка обработки ошибок

3. **Отладочные возможности**
   - Подробный вывод каждой операции
   - Цветовая индикация успеха/неудачи
   - Вывод деталей ошибок

### Запуск тестов

```bash
chmod +x test_memfs_debug.sh
./test_memfs_debug.sh
```

## Ограничения

- Файловая система существует только в памяти и не сохраняет данные после размонтирования
- Отсутствует поддержка жестких и символических ссылок
- Нет поддержки расширенных атрибутов файлов
- Ограничения на размер файлов зависят от доступной памяти

## Безопасность

- Базовая защита от параллельного доступа через mutex
- Проверка прав доступа на уровне операций с файлами
- Изоляция данных в пределах смонтированной файловой системы

## Направления развития

1. Добавление поддержки символических ссылок
2. Реализация журналирования операций
3. Добавление квот на использование памяти
4. Реализация механизма persistence (сохранение на диск)
5. Улучшение производительности работы с большими файлами